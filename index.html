<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Volleyball Tournaments</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="site-header">
    <h1>Upcoming Volleyball Tournaments</h1>
    <nav>
      <a href="submit.html" class="submit-btn">Submit Your Event</a>
    </nav>
  </header>

  <div class="content">
    <table id="eventsTable" border="1">
      <thead>
        <tr>
          <th>Event Name</th>
          <th>Province</th>
          <th>City</th>
          <th>Region</th>
          <th>Date</th>
          <th>Level</th>
          <th>Registration</th>
          <th>Address</th>
        </tr>
      </thead>
      <tbody>
        <!-- Events will load here -->
      </tbody>
    </table>
    <p id="noEventsMessage" style="display:none;">No upcoming tournaments.</p>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
    import { firebaseConfig } from './config.js';

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const eventsTable = document.getElementById("eventsTable").querySelector("tbody");
    const noEventsMessage = document.getElementById("noEventsMessage");

    async function loadEvents() {
      const snapshot = await getDocs(collection(db, "tournaments_public"));
      const today = new Date().toISOString().split("T")[0]; // YYYY-MM-DD
      const events = [];

      snapshot.forEach(doc => {
        const data = doc.data();
        if (data.date >= today) {   // Only upcoming events
          events.push(data);
        }
      });

      // Sort by date
      events.sort((a, b) => a.date.localeCompare(b.date));

      if (events.length === 0) {
        noEventsMessage.style.display = "block";
        return;
      }

      events.forEach(ev => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${ev.name}</td>
          <td>${ev.province}</td>
          <td>${ev.city}</td>
          <td>${ev.region || ""}</td>
          <td>${ev.date}</td>
          <td>${ev.level}</td>
          <td>${ev.registration || ""}</td>
          <td>${ev.address || ""}</td>
        `;
        eventsTable.appendChild(row);
      });
    }

    loadEvents();
  </script>
</body>
</html>
